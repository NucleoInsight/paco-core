<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Conteúdo Exclusivo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        /* RESET E BASE */
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; transition: 0.3s; line-height: 1.6; }
        .hidden { display: none !important; }
        #loading { position: fixed; inset: 0; background: #000; color: #fff; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; font-family: 'Inter', sans-serif; font-weight: bold; letter-spacing: 2px; }
        
        /* --- TEMA 1: VSL (Conversão Agressiva) --- */
        body.layout-dark { background-color: #0b0c15; color: #e2e8f0; font-family: 'Inter', sans-serif; }
        .layout-dark .container { max-width: 800px; margin: 0 auto; padding: 20px; text-align: center; }
        .layout-dark #headline { color: #ef4444; font-size: 26px; font-weight: 900; text-transform: uppercase; margin-bottom: 20px; line-height: 1.2; text-shadow: 0 0 20px rgba(239, 68, 68, 0.3); }
        .layout-dark #bodyText { font-size: 18px; color: #94a3b8; margin-top: 20px; text-align: left; }
        .layout-dark .btn { background: linear-gradient(to bottom, #10b981, #059669); color: white; border-bottom: 4px solid #065f46; box-shadow: 0 0 15px rgba(16, 185, 129, 0.4); }
        .layout-dark .btn:active { transform: translateY(2px); border-bottom: 2px solid #065f46; }

        /* --- TEMA 2: ARTIGO (Autoridade/Notícia) --- */
        body.layout-artigo { background-color: #ffffff; color: #111; font-family: 'Merriweather', serif; }
        .layout-artigo .container { max-width: 700px; margin: 0 auto; padding: 20px; }
        .layout-artigo #news-bar { display: block !important; background: #b91c1c; color: white; text-align: center; padding: 8px; font-family: 'Inter', sans-serif; font-weight: 700; font-size: 12px; letter-spacing: 1px; text-transform: uppercase; }
        .layout-artigo #headline { font-size: 32px; font-weight: 900; line-height: 1.2; color: #1a202c; margin-bottom: 10px; margin-top: 20px; }
        .layout-artigo #meta-info { display: block !important; border-bottom: 1px solid #e2e8f0; padding-bottom: 15px; margin-bottom: 20px; color: #64748b; font-size: 14px; font-family: 'Inter', sans-serif; }
        .layout-artigo #bodyText { font-size: 19px; color: #334155; line-height: 1.8; }
        .layout-artigo .video-box { margin: 30px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .layout-artigo .btn { background: #b91c1c; color: white; font-family: 'Inter', sans-serif; text-transform: uppercase; font-weight: bold; padding: 20px; width: 100%; border-radius: 4px; font-size: 20px; margin-top: 30px; }

        /* --- TEMA 3: CLEAN (Nota Oficial) --- */
        body.layout-clean { background-color: #f1f5f9; color: #334155; font-family: 'Inter', sans-serif; }
        .layout-clean .container { max-width: 600px; margin: 50px auto; background: white; padding: 50px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; border-top: 5px solid #3b82f6; }
        .layout-clean #headline { color: #1e293b; font-size: 24px; font-weight: 800; margin-bottom: 20px; }
        .layout-clean .btn { background: #3b82f6; color: white; border-radius: 8px; }

        /* --- VIDEO PLAYER & ESCUDO --- */
        .video-box { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; background: #000; border-radius: 8px; }
        .video-box iframe { position: absolute; top: -17%; left: -17%; width: 134%; height: 134%; z-index: 1; }
        .video-shield { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; background: transparent; cursor: pointer; }

        /* --- ELEMENTOS GERAIS --- */
        .btn { display: block; width: 100%; padding: 18px; border: none; cursor: pointer; transition: 0.2s; font-size: 18px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
        
        /* QUIZ */
        .layout-quiz { background: #0f172a; color: white; font-family: 'Inter', sans-serif; }
        .layout-quiz .container { max-width: 500px; margin: 40px auto; padding: 20px; text-align: center; }
        .quiz-option { background: #1e293b; border: 2px solid #334155; padding: 20px; margin-bottom: 15px; border-radius: 12px; cursor: pointer; text-align: left; font-weight: 600; transition: 0.2s; }
        .quiz-option:hover { border-color: #10b981; background: #1e293b; transform: translateX(5px); }

        #test-banner { background:#f59e0b; color:#000; text-align:center; font-size:12px; font-weight:bold; padding:8px; font-family:sans-serif; }
    </style>
</head>
<body class="layout-dark"> <div id="news-bar" class="hidden">NOTÍCIA • ECONOMIA • BRASIL</div>
    
    <div id="test-banner" class="hidden">⚠️ MODO TESTE ATIVO</div>
    
    <div id="loading">
        <div style="width: 40px; height: 40px; border: 4px solid #fff; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px;"></div>
        <span style="font-size:12px; opacity:0.7">CARREGANDO CONTEÚDO...</span>
    </div>
    <style>@keyframes spin { to { transform: rotate(360deg); } }</style>

    <div id="quiz-area" class="container hidden">
        <div style="background:#334155; height:6px; width:100%; margin-bottom:30px; border-radius:3px; overflow:hidden;">
            <div id="progress-bar" style="background:#10b981; height:100%; width:0%; transition: width 0.3s;"></div>
        </div>
        <h2 id="quiz-question" style="font-size:24px; font-weight:800; margin-bottom:30px;">...</h2>
        <div id="quiz-options"></div>
    </div>

    <div id="app" class="container hidden">
        <h1 id="headline">...</h1>
        
        <div id="meta-info" class="hidden">
            <span style="font-weight:bold; color:#b91c1c;">Por Redação</span> • <span>Atualizado hoje às 08:30</span>
        </div>

        <div id="videoArea" class="video-box hidden">
            <iframe id="videoFrame" src="" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
            <div class="video-shield"></div>
        </div>

        <div id="bodyText">...</div>
        
        <div id="price-area" style="margin-top: 30px; text-align: center;">
            <p id="priceDisplay" style="font-size:28px; font-weight:bold; margin-bottom: 10px; display:none">...</p>
            <button id="buyBtn" class="btn">...</button>
            <p style="font-size:12px; margin-top:10px; opacity:0.6;">Compra 100% Segura e Garantida</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyBcVJ34TlzOVRUZ0SDJcl8OqF4V7PxxbIg", authDomain: "paco-core.firebaseapp.com", projectId: "paco-core", storageBucket: "paco-core.firebasestorage.app", messagingSenderId: "88467987691", appId: "1:88467987691:web:85892f360253aa957c72ae" };
        const app = initializeApp(firebaseConfig); const db = getFirestore(app);

        const urlParams = new URLSearchParams(window.location.search);
        const offerId = urlParams.get('id');
        const isTest = urlParams.get('mode') === 'test';
        let sessionId = sessionStorage.getItem('paco_sid');
        if(!sessionId) { sessionId = 'u_' + Math.random().toString(36).substr(2, 9); sessionStorage.setItem('paco_sid', sessionId); }

        let source = urlParams.get('utm_source');
        if (!source) {
            const ref = document.referrer;
            if (ref.includes('instagram')) source = 'instagram'; else if (ref.includes('facebook')) source = 'facebook'; else if (ref.includes('youtube')) source = 'youtube'; else if (ref) source = new URL(ref).hostname; else source = 'direto';
        }

        async function track(name, data={}) {
            if(!offerId) return;
            try { await addDoc(collection(db, "events"), { offerId, sessionId, type: name, isTest, campaign: {source, campaign: urlParams.get('utm_campaign')||''}, createdAt: serverTimestamp(), data }); } catch(e){}
        }

        const questions = [ { t: "Qual seu principal objetivo hoje?", a: ["Ganhar Dinheiro Extra", "Mudar de Carreira", "Apenas Curiosidade"] }, { t: "Quanto tempo você tem disponível?", a: ["30 min por dia", "1 a 2 horas", "Tempo Integral"] }, { t: "O que te impede de começar?", a: ["Falta de Dinheiro", "Falta de Conhecimento", "Medo de falhar"] } ];

        async function init() {
            if (!offerId) { document.getElementById('loading').innerHTML = "ERRO: Link inválido."; return; }
            if(isTest) document.getElementById('test-banner').classList.remove('hidden');

            try {
                const docSnap = await getDoc(doc(db, "offers", offerId));
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    let layout = data.layout || 'dark';
                    if(layout === 'vsl') layout = 'dark'; // Garante fallback
                    
                    // APLICA O TEMA NO BODY
                    document.body.className = `layout-${layout}`;

                    if(layout === 'quiz') { document.getElementById('loading').classList.add('hidden'); startQuiz(data); return; }
                    
                    renderOffer(data, layout);
                } else { document.getElementById('loading').innerHTML = "Oferta não encontrada."; }
            } catch (e) { console.error(e); }
        }

        function renderOffer(data, layout) {
            document.getElementById('headline').innerText = data.headline;
            
            // Tratamento de quebra de linha para o Texto do Corpo
            document.getElementById('bodyText').innerHTML = data.bodyText.replace(/\n/g, '<br>');
            
            document.getElementById('priceDisplay').innerText = "R$ " + data.price;
            if(data.price) document.getElementById('priceDisplay').style.display = 'block';
            
            document.getElementById('buyBtn').innerText = data.ctaText || "QUERO APROVEITAR AGORA";

            // Se for Artigo, mostra os elementos específicos
            if(layout === 'artigo') {
                document.getElementById('news-bar').classList.remove('hidden');
                document.getElementById('meta-info').classList.remove('hidden');
            }

            // --- VÍDEO COM HACK ANTI-RECOMENDAÇÃO ---
            if(data.videoUrl && data.videoUrl.length > 5) {
                let videoId = "";
                const match = data.videoUrl.match(/(?:youtu\.be\/|youtube\.com\/(?:.*v=|.*\/)([^#&?]*))/);
                if (match && match[1]) videoId = match[1];

                if(videoId) {
                    let vUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=0&rel=0&playsinline=1&modestbranding=1&iv_load_policy=3&showinfo=0&fs=0&disablekb=1&loop=1&playlist=${videoId}`;
                    document.getElementById('videoFrame').src = vUrl;
                    document.getElementById('videoArea').classList.remove('hidden');
                }
            }

            document.getElementById('loading').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            track('offer_view');
            
            document.getElementById('buyBtn').onclick = () => {
                track('cta_click');
                const btn = document.getElementById('buyBtn');
                btn.innerText = "REDIRECIONANDO...";
                btn.style.opacity = "0.7";
                if(data.checkoutUrl) window.location.href = data.checkoutUrl;
                else alert("Checkout não configurado");
            };
        }

        function startQuiz(offerData) {
            document.getElementById('quiz-area').classList.remove('hidden');
            track('offer_view');
            let qIdx = 0;
            function showQ() {
                const q = questions[qIdx];
                document.getElementById('quiz-question').innerText = q.t;
                const opts = document.getElementById('quiz-options');
                opts.innerHTML = "";
                document.getElementById('progress-bar').style.width = (((qIdx+1)/questions.length)*100)+"%";
                q.a.forEach(ans => {
                    const d = document.createElement('div');
                    d.className = 'quiz-option'; d.innerText = ans;
                    d.onclick = () => { track('quiz_answer', {answer: ans}); qIdx++; if(qIdx<questions.length) showQ(); else finishQuiz(offerData); };
                    opts.appendChild(d);
                });
            }
            showQ();
        }

        function finishQuiz(offerData) {
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('loading').innerHTML = `
                <div style="font-size:16px; margin-bottom:10px">ANALISANDO PERFIL...</div>
                <div style="background:#333; width:200px; height:6px; border-radius:3px;"><div style="background:#10b981; height:100%; width:100%; animation: load 1.5s ease-in-out;"></div></div>
                <style>@keyframes load { from {width:0%} to {width:100%} }</style>
            `;
            setTimeout(() => { 
                // Ao terminar o quiz, vai para o layout Dark (VSL)
                document.body.className = 'layout-dark'; 
                renderOffer(offerData, 'dark'); 
            }, 1500);
        }

        init();
    </script>
</body>
</html>
