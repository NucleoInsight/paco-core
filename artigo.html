<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Artigo do Dia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* ESTILO NOTÍCIA/BLOG */
        body { font-family: 'Georgia', serif; background: #fff; color: #222; margin: 0; padding: 0; }
        .top-bar { background: #cc0000; color: white; padding: 10px; text-align: center; font-weight: bold; font-family: sans-serif; font-size: 12px; }
        
        .container { max-width: 700px; margin: 0 auto; padding: 20px; }
        
        .meta { color: #666; font-size: 14px; font-family: sans-serif; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .meta span { margin-right: 15px; }
        
        h1 { font-family: sans-serif; font-size: 32px; line-height: 1.2; margin-bottom: 10px; color: #111; font-weight: 900; }
        
        .content { font-size: 19px; line-height: 1.6; color: #333; margin-bottom: 30px; }
        .content p { margin-bottom: 20px; }
        
        .offer-box { background: #fff9c4; border: 2px dashed #fbc02d; padding: 30px; text-align: center; font-family: sans-serif; }
        .offer-title { font-weight: bold; font-size: 20px; margin-bottom: 10px; }
        
        .cta-button { display: inline-block; background: #cc0000; color: #fff; text-align: center; padding: 15px 30px; font-size: 18px; text-decoration: none; font-weight: bold; cursor: pointer; border: none; border-radius: 4px; }
        .cta-button:hover { background: #b30000; }
        
        .hidden { display: none; }
        #loading { text-align: center; padding: 50px; font-family: sans-serif; color: #666; }
    </style>
</head>
<body>

    <div class="top-bar">NOTÍCIAS • ECONOMIA • ESTILO DE VIDA</div>

    <div id="loading">Carregando notícia...</div>

    <div id="app" class="container hidden">
        <h1 id="headline">...</h1>
        
        <div class="meta">
            <span>Por <strong>Redação</strong></span>
            <span>Atualizado hoje</span>
        </div>

        <div class="content">
            <p id="bodyText" style="white-space: pre-wrap;">...</p>
        </div>

        <div class="offer-box">
            <div class="offer-title">Oferta Limitada para Leitores</div>
            <p style="font-size:14px;">Acesso liberado por apenas <strong>R$ <span id="price">...</span></strong></p>
            <button id="buyBtn" class="cta-button">...</button>
        </div>
        
        <br><br><br>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIGURAÇÃO CORRETA DO PACO-CORE
        const firebaseConfig = { apiKey: "AIzaSyBcVJ34TlzOVRUZ0SDJcl8OqF4V7PxxbIg", authDomain: "paco-core.firebaseapp.com", projectId: "paco-core", storageBucket: "paco-core.firebasestorage.app", messagingSenderId: "88467987691", appId: "1:88467987691:web:85892f360253aa957c72ae" };
        const app = initializeApp(firebaseConfig); const db = getFirestore(app);

        // Lógica de Sessão e UTM (Igual ao Index.html para funcionar no Painel)
        const urlParams = new URLSearchParams(window.location.search);
        const offerId = urlParams.get('id');
        const isTest = urlParams.get('mode') === 'test';
        let sessionId = sessionStorage.getItem('paco_sid');
        if(!sessionId) { sessionId = 'u_' + Math.random().toString(36).substr(2, 9); sessionStorage.setItem('paco_sid', sessionId); }

        let source = urlParams.get('utm_source');
        if (!source) {
            const ref = document.referrer;
            if (ref.includes('instagram')) source = 'instagram';
            else if (ref.includes('facebook')) source = 'facebook';
            else if (ref.includes('youtube')) source = 'youtube';
            else if (ref) source = new URL(ref).hostname;
            else source = 'direto';
        }

        async function track(name, data={}) {
            if(!offerId) return;
            try { 
                // Agora salva em 'events' para aparecer no Dashboard
                await addDoc(collection(db, "events"), { 
                    offerId, sessionId, type: name, isTest, 
                    campaign: {source, campaign: urlParams.get('utm_campaign')||''}, 
                    createdAt: serverTimestamp(), data 
                }); 
            } catch(e){}
        }

        async function init() {
            if (!offerId) { document.body.innerHTML = "<p style='text-align:center;padding:50px'>Link inválido ou incompleto.</p>"; return; }
            
            try {
                const docSnap = await getDoc(doc(db, "offers", offerId));
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    
                    document.getElementById('headline').innerText = data.headline;
                    // white-space: pre-wrap no CSS permite quebras de linha do banco de dados
                    document.getElementById('bodyText').innerText = data.bodyText; 
                    document.getElementById('price').innerText = data.price;
                    document.getElementById('buyBtn').innerText = data.ctaText || "QUERO APROVEITAR";
                    
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('app').classList.remove('hidden');
                    
                    // Rastreia a visualização corretamente
                    track('offer_view');

                    document.getElementById('buyBtn').onclick = () => {
                        track('cta_click');
                        const btn = document.getElementById('buyBtn');
                        btn.innerText = "AGUARDE...";
                        if(data.checkoutUrl) window.location.href = data.checkoutUrl;
                        else alert("Link de Checkout não configurado no Painel.");
                    };
                } else {
                    document.getElementById('loading').innerText = "Oferta não encontrada.";
                }
            } catch (e) { console.error(e); }
        }
        init();
    </script>
</body>
</html>
